<!DOCTYPE html>  <html> <head>   <title>form-view.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="application.html">                 application.coffee               </a>                                           <a class="source" href="collection-view.html">                 collection-view.coffee               </a>                                           <a class="source" href="collection.html">                 collection.coffee               </a>                                           <a class="source" href="composite-view.html">                 composite-view.coffee               </a>                                           <a class="source" href="error-model.html">                 error-model.coffee               </a>                                           <a class="source" href="form-view.html">                 form-view.coffee               </a>                                           <a class="source" href="index.html">                 index.coffee               </a>                                           <a class="source" href="item-view.html">                 item-view.coffee               </a>                                           <a class="source" href="model.html">                 model.coffee               </a>                                           <a class="source" href="region-manager.html">                 region-manager.coffee               </a>                                           <a class="source" href="router.html">                 router.coffee               </a>                                           <a class="source" href="store.html">                 store.coffee               </a>                                           <a class="source" href="utils.html">                 utils.coffee               </a>                                           <a class="source" href="view-model.html">                 view-model.coffee               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               form-view.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre><span class="nv">ItemView = </span><span class="nx">require</span> <span class="s">&#39;./item-view&#39;</span>
<span class="nv">_ = </span><span class="nx">require</span> <span class="s">&#39;underscore&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>The default FormView class that can be
used as a base class.</p>

<p>No events are included. To use the default
form view, pass 'handleFormSubmit' to the
submit event of your form.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">FormView</span> <span class="k">extends</span> <span class="nx">ItemView</span>

<span class="nv">server_error_message = </span><span class="s">&quot;&quot;&quot;</span>
<span class="s">There was an error communicating with the server.</span>
<span class="s">&quot;&quot;&quot;</span>
<span class="nv">please_retry_message = </span><span class="s">&quot;&quot;&quot;</span>
<span class="s">Please try again in a few minutes. If the error persists,</span>
<span class="s">please contact support.</span>
<span class="s">&quot;&quot;&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>The basic form view is included here as a MixIn that can
be mixed into other views.</p>

<p>It provides a default implementation of syncing a form
to a model, and a submit event handler that will
save the model to the server.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nv">FormViewMixin =</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>override for custom handling</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">formToObject: </span><span class="o">-&gt;</span> <span class="nx">@$</span><span class="p">(</span><span class="s">&#39;form&#39;</span><span class="p">).</span><span class="nx">toObject</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>Take xhr response, and build error object</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">_handleError: </span><span class="nf">(res) -&gt;</span>
    <span class="k">if</span> <span class="nx">res</span><span class="p">.</span><span class="nx">status</span> <span class="o">==</span> <span class="mi">401</span>
      <span class="nx">@trigger</span> <span class="s">&#39;unauthorized&#39;</span>
      <span class="vi">@error = </span><span class="p">{</span><span class="nv">message: </span><span class="nx">unauthorized_message</span><span class="p">}</span>

    <span class="k">if</span> <span class="nx">res</span><span class="p">.</span><span class="nx">status</span> <span class="k">in</span> <span class="p">[</span><span class="mi">502</span><span class="p">,</span><span class="mi">504</span><span class="p">]</span> <span class="c1"># bad gateway, gateway timeout</span>
      <span class="nv">message = </span><span class="nx">server_error_message</span>
      <span class="nx">message</span> <span class="o">+=</span> <span class="s">&#39;\n&#39;</span> <span class="o">+</span> <span class="nx">please_retry_message</span>
      <span class="vi">@error = </span><span class="p">{</span><span class="nx">message</span><span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>forbidden, not found, unprocessable entity</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="nx">res</span><span class="p">.</span><span class="nx">status</span> <span class="k">in</span> <span class="p">[</span><span class="mi">403</span><span class="p">,</span><span class="mi">404</span><span class="p">,</span><span class="mi">422</span><span class="p">]</span>
      <span class="k">try</span>
        <span class="vi">@error = </span><span class="k">if</span> <span class="nx">res</span><span class="p">.</span><span class="nx">responseText</span> <span class="k">then</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">responseText</span><span class="p">)</span> <span class="k">else</span> <span class="nx">res</span>
      <span class="k">catch</span> <span class="nx">e</span>
        <span class="vi">@error = </span><span class="p">{</span><span class="nv">message: </span><span class="s">&quot;Error&quot;</span><span class="p">}</span>

    <span class="k">if</span> <span class="o">!</span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span>
      <span class="vi">@error = </span><span class="nx">res</span>

    <span class="nx">@error</span><span class="p">.</span><span class="nx">message</span> <span class="o">?=</span> <span class="s">&quot;Error&quot;</span>

  <span class="nv">onRender: </span><span class="o">-&gt;</span>
    <span class="nx">@binder</span><span class="p">.</span><span class="nx">bind</span> <span class="nx">@model</span><span class="p">,</span> <span class="nx">@$el</span> <span class="k">if</span> <span class="nx">@binder</span>

  <span class="nv">wysihtml5ParserRules:</span>
    <span class="nv">tags:</span>
      <span class="nv">strong: </span><span class="p">{},</span> <span class="nv">b: </span><span class="p">{},</span> <span class="nv">i: </span><span class="p">{},</span> <span class="nv">em: </span><span class="p">{},</span> <span class="nv">br: </span><span class="p">{},</span> <span class="nv">p: </span><span class="p">{},</span>
      <span class="nv">div: </span><span class="p">{},</span> <span class="nv">span: </span><span class="p">{},</span> <span class="nv">ul: </span><span class="p">{},</span> <span class="nv">ol: </span><span class="p">{},</span> <span class="nv">li: </span><span class="p">{},</span>
      <span class="nv">a:</span>
        <span class="nv">set_attributes:</span>
          <span class="nv">target: </span><span class="s">&quot;_blank&quot;</span>
          <span class="nv">rel: </span>   <span class="s">&quot;nofollow&quot;</span>
        <span class="nv">check_attributes:</span>
          <span class="nv">href: </span>  <span class="s">&quot;url&quot;</span> <span class="c1"># important to avoid XSS</span>

  <span class="nv">handleFormSubmit: </span><span class="nf">(e) -&gt;</span>
    <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">()</span>

    <span class="nv">callbacks =</span>
      <span class="nv">success: </span><span class="p">(</span><span class="nx">model</span><span class="p">,</span> <span class="nx">resp</span><span class="p">)</span> <span class="o">=&gt;</span>
        <span class="nx">@trigger</span> <span class="s">&#39;success&#39;</span><span class="p">,</span> <span class="nx">@model</span>

      <span class="nv">error: </span><span class="p">(</span><span class="nx">model</span><span class="p">,</span> <span class="nx">response</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="o">=&gt;</span>
        <span class="nx">@_handleError</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="s">&quot;Handle error&quot;</span><span class="p">,</span> <span class="nx">model</span><span class="p">,</span> <span class="nx">response</span><span class="p">,</span> <span class="nx">options</span>
        <span class="nx">@rerender</span><span class="p">()</span>
        <span class="nx">@trigger</span> <span class="s">&#39;error&#39;</span><span class="p">,</span> <span class="nx">@error</span>

    <span class="vi">@error = </span><span class="nx">@model</span><span class="p">.</span><span class="nx">savable</span><span class="p">()</span>
    <span class="k">return</span> <span class="nx">@rerender</span><span class="p">()</span> <span class="k">if</span> <span class="nx">@error</span>

    <span class="k">if</span> <span class="nx">@collection</span>
      <span class="nx">@collection</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">@model</span><span class="p">,</span> <span class="nx">callbacks</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="nx">@model</span><span class="p">.</span><span class="nx">save</span><span class="p">({},</span> <span class="nx">callbacks</span><span class="p">)</span>

<span class="nx">_</span><span class="p">.</span><span class="nx">extend</span> <span class="nx">FormView</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="nx">FormViewMixin</span>

<span class="nv">module.exports = </span><span class="p">{</span><span class="nx">FormView</span><span class="p">,</span> <span class="nx">FormViewMixin</span><span class="p">}</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 