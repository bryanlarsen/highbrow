<!DOCTYPE html>  <html> <head>   <title>item-view.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="application.html">                 application.coffee               </a>                                           <a class="source" href="collection-view.html">                 collection-view.coffee               </a>                                           <a class="source" href="collection.html">                 collection.coffee               </a>                                           <a class="source" href="composite-view.html">                 composite-view.coffee               </a>                                           <a class="source" href="error-model.html">                 error-model.coffee               </a>                                           <a class="source" href="form-view.html">                 form-view.coffee               </a>                                           <a class="source" href="index.html">                 index.coffee               </a>                                           <a class="source" href="item-view.html">                 item-view.coffee               </a>                                           <a class="source" href="model.html">                 model.coffee               </a>                                           <a class="source" href="region-manager.html">                 region-manager.coffee               </a>                                           <a class="source" href="router.html">                 router.coffee               </a>                                           <a class="source" href="store.html">                 store.coffee               </a>                                           <a class="source" href="utils.html">                 utils.coffee               </a>                                           <a class="source" href="view-model.html">                 view-model.coffee               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               item-view.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre><span class="nv">Backbone = </span><span class="nx">require</span> <span class="s">&#39;backbone&#39;</span>
<span class="nv">_ = </span><span class="nx">require</span> <span class="s">&#39;underscore&#39;</span>
<span class="nv">utils    = </span><span class="nx">require</span> <span class="s">&#39;./utils&#39;</span>
<span class="nv">nct      = </span><span class="nx">utils</span><span class="p">.</span><span class="nx">nct</span>
<span class="nx">require</span> <span class="s">&#39;model_binder&#39;</span> <span class="k">if</span> <span class="nx">utils</span><span class="p">.</span><span class="nx">browser</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>A single item view implementation that contains code for rendering
and calling several methods on extended views, such as <code>onRender</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">ItemView</span> <span class="k">extends</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>In addition to the standard keys that can be passed to normal
Backbone views, this view class also takes the following keys:</p>

<p>template: The name of the template to be used for this view.
  Normally, this template name is derived from the name of the
  view, converted into lowercase and underscores. So, if the name
  of the view is "UserSignup", the template name that will be used
  is "user_signup".</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">constructor: </span> <span class="o">-&gt;</span>
    <span class="k">super</span>
    <span class="nx">@name</span> <span class="o">?=</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">name</span> <span class="o">||</span> <span class="nx">@constructor</span><span class="p">.</span><span class="nx">name</span>
    <span class="nx">@template</span> <span class="o">?=</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">template</span>
    <span class="vi">@namespace = </span><span class="nx">@options</span><span class="p">.</span><span class="nx">namespace</span> <span class="k">if</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">namespace</span>
    <span class="nx">@namespace</span> <span class="o">?=</span> <span class="nx">@constructor</span><span class="p">.</span><span class="nx">namespace</span>
    <span class="nx">@workflow</span> <span class="o">?=</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">workflow</span> <span class="o">||</span> <span class="p">{}</span>
    <span class="vi">@binder = </span><span class="k">new</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">ModelBinder</span><span class="p">()</span> <span class="k">if</span> <span class="nx">utils</span><span class="p">.</span><span class="nx">browser</span> <span class="o">and</span> <span class="nx">@model</span>
    <span class="nx">unless</span> <span class="nx">@template</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s">&quot;Unknown template. Please provide a name or template&quot;</span><span class="p">)</span> <span class="nx">unless</span> <span class="nx">@name</span>
      <span class="nv">template = </span><span class="nx">_</span><span class="p">.</span><span class="nx">underscored</span><span class="p">(</span><span class="nx">@name</span><span class="p">)</span>
      <span class="vi">@template = </span><span class="k">if</span> <span class="nx">@namespace</span> <span class="k">then</span> <span class="nx">@namespace</span> <span class="o">+</span> <span class="s">&#39;/&#39;</span> <span class="o">+</span> <span class="nx">template</span> <span class="k">else</span> <span class="nx">template</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>When rendering a collection</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">id: </span><span class="o">-&gt;</span>
    <span class="nv">id = </span><span class="s">&#39;view-&#39;</span><span class="o">+</span><span class="p">(</span><span class="nx">@template</span> <span class="o">||</span> <span class="nx">_</span><span class="p">.</span><span class="nx">underscored</span><span class="p">(</span><span class="nx">@name</span> <span class="o">||</span> <span class="s">&#39;&#39;</span><span class="p">))</span>
    <span class="nv">id = </span><span class="nx">id</span><span class="o">+</span><span class="s">&#39;-&#39;</span><span class="o">+</span><span class="nx">@model</span><span class="p">.</span><span class="nx">id</span> <span class="k">if</span> <span class="nx">@model</span> <span class="o">and</span> <span class="nx">@model</span><span class="p">.</span><span class="nx">id</span>
    <span class="nx">id</span>


  <span class="nv">delegateEvents: </span><span class="nf">(events) -&gt;</span>
    <span class="k">return</span> <span class="k">if</span> <span class="nx">utils</span><span class="p">.</span><span class="nx">server</span>
    <span class="k">super</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>override to specify title,subtitle,subnav</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">view: </span><span class="p">{}</span>

  <span class="nv">data: </span><span class="o">-&gt;</span>
    <span class="k">return</span> <span class="p">{}</span> <span class="nx">unless</span> <span class="nx">@model</span>
    <span class="nv">viewModel = </span><span class="nx">@viewModel</span> <span class="o">||</span> <span class="nx">ItemView</span><span class="p">.</span><span class="nx">viewModels</span><span class="p">[</span><span class="nx">@model</span><span class="p">.</span><span class="nx">name</span><span class="p">]</span>
    <span class="k">if</span> <span class="nx">viewModel</span> <span class="k">then</span> <span class="k">new</span> <span class="nx">viewModel</span><span class="p">(</span><span class="nx">@model</span><span class="p">,</span> <span class="nx">@error</span><span class="p">)</span> <span class="k">else</span> <span class="nx">@model</span>

  <span class="nv">context: </span><span class="o">-&gt;</span>
    <span class="nv">viewdata = </span><span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isFunction</span><span class="p">(</span><span class="nx">@view</span><span class="p">)</span> <span class="k">then</span> <span class="nx">@view</span><span class="p">()</span> <span class="k">else</span> <span class="nx">@view</span>
    <span class="nv">ctx = </span><span class="k">new</span> <span class="nx">nct</span><span class="p">.</span><span class="nx">Context</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span><span class="nx">@workflow</span><span class="p">},</span> <span class="nx">viewdata</span><span class="p">))</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">@data</span><span class="p">())</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>Ensure that the View has a DOM element to render into.
If <code>this.el</code> is a string, pass it through <code>$()</code>, take the first
matching element, and re-assign it to <code>el</code>. Otherwise, create
an element from the <code>id</code>, <code>className</code> and <code>tagName</code> properties.</p>

<p>Changes from Backbone default:
* If we are in the browser, check to see if the view has
  already been rendered (by the server).</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">_ensureElement: </span><span class="o">-&gt;</span>
    <span class="k">return</span> <span class="nx">@setElement</span><span class="p">(</span><span class="nx">@el</span><span class="p">,</span> <span class="kc">false</span><span class="p">)</span> <span class="k">if</span> <span class="nx">@el</span>
    <span class="k">if</span> <span class="nx">@id</span> <span class="o">and</span> <span class="nx">utils</span><span class="p">.</span><span class="nx">browser</span>
      <span class="nv">el = </span><span class="nx">$</span><span class="p">(</span><span class="s">&#39;#&#39;</span><span class="o">+</span> <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isFunction</span><span class="p">(</span><span class="nx">@id</span><span class="p">)</span> <span class="k">then</span> <span class="nx">@id</span><span class="p">()</span> <span class="k">else</span> <span class="nx">@id</span><span class="p">)</span>
      <span class="k">return</span> <span class="nx">@setElement</span><span class="p">(</span><span class="nx">el</span><span class="p">,</span> <span class="kc">false</span><span class="p">)</span> <span class="k">if</span> <span class="nx">el</span><span class="p">.</span><span class="nx">length</span> <span class="o">and</span> <span class="nx">el</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s">&#39;ssr&#39;</span><span class="p">)</span>
    <span class="nv">attrs = </span><span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">({},</span> <span class="nx">@attributes</span><span class="p">)</span>
    <span class="nv">attrs.id = </span><span class="nx">@id</span> <span class="k">if</span> <span class="nx">@id</span>
    <span class="nv">attrs.id = </span><span class="nx">@id</span><span class="p">()</span> <span class="k">if</span> <span class="nx">@id</span> <span class="o">and</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isFunction</span><span class="p">(</span><span class="nx">@id</span><span class="p">)</span>
    <span class="nx">attrs</span><span class="p">[</span><span class="s">&#39;class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">@className</span> <span class="k">if</span> <span class="nx">@className</span>
    <span class="nx">@setElement</span> <span class="nx">@make</span><span class="p">(</span><span class="nx">@tagName</span><span class="p">,</span> <span class="nx">attrs</span><span class="p">),</span> <span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>var el = this.make('li', {'class': 'row'}, this.model.escape('title'));
Changes from Backbone:
 Use highbrow.$ to create elements on the server</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">make: </span><span class="nf">(tagName, attributes, content) -&gt;</span>
    <span class="nv">el = </span><span class="k">if</span> <span class="nx">utils</span><span class="p">.</span><span class="nx">browser</span> <span class="k">then</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="nx">tagName</span><span class="p">)</span> <span class="k">else</span> <span class="nx">utils</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="s">&quot;&lt;&quot;</span><span class="o">+</span><span class="nx">tagName</span><span class="o">+</span><span class="s">&quot;&gt;&lt;/&quot;</span><span class="o">+</span><span class="nx">tagName</span><span class="o">+</span><span class="s">&quot;&gt;&quot;</span><span class="p">)</span>
    <span class="nx">utils</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="nx">el</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="nx">attributes</span><span class="p">)</span> <span class="k">if</span> <span class="nx">attributes</span>
    <span class="nx">utils</span><span class="p">.</span><span class="nx">$</span><span class="p">(</span><span class="nx">el</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">content</span><span class="p">)</span> <span class="k">if</span> <span class="nx">content</span> <span class="o">!=</span> <span class="kc">null</span>
    <span class="nx">el</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>Render template will render the associated template.
* We do not rerender the template, if the view has already been
  rendered on the server.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">renderTemplate: </span> <span class="o">-&gt;</span>
    <span class="k">return</span> <span class="nx">unless</span> <span class="nx">@template</span>
    <span class="k">if</span> <span class="nx">utils</span><span class="p">.</span><span class="nx">browser</span> <span class="o">and</span> <span class="nx">@$el</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s">&#39;ssr&#39;</span><span class="p">)</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="s">&quot;skipping render&quot;</span><span class="p">,</span> <span class="nx">@template</span>
      <span class="nx">@$el</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s">&#39;ssr&#39;</span><span class="p">,</span> <span class="kc">false</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="nx">@$el</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s">&#39;data-ssr&#39;</span><span class="p">,</span> <span class="s">&#39;true&#39;</span><span class="p">)</span> <span class="nx">unless</span> <span class="nx">utils</span><span class="p">.</span><span class="nx">browser</span>
      <span class="nx">@$el</span><span class="p">.</span><span class="nx">html</span> <span class="nx">nct</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="nx">@template</span><span class="p">,</span> <span class="nx">@context</span><span class="p">())</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span> <span class="s">&quot;rendered&quot;</span><span class="p">,</span> <span class="nx">@$el</span><span class="p">,</span> <span class="nx">@template</span> <span class="k">if</span> <span class="nx">utils</span><span class="p">.</span><span class="nx">browser</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>Render the view with nct templates
You can override this in your view definition.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">render: </span><span class="o">-&gt;</span>
    <span class="nx">@renderTemplate</span><span class="p">()</span>
    <span class="nx">@onRender</span><span class="p">()</span> <span class="k">if</span> <span class="nx">utils</span><span class="p">.</span><span class="nx">browser</span>
    <span class="nx">@</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>empty the associated element, and render</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">rerender: </span><span class="o">-&gt;</span>
    <span class="nx">@$el</span><span class="p">.</span><span class="nx">empty</span><span class="p">()</span>
    <span class="nx">@render</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>A helper function to simplify using Backbone ModelBinder</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">convertBindings: </span><span class="nf">(bindings) -&gt;</span>
    <span class="nv">result = </span><span class="p">{}</span>
    <span class="nx">_</span><span class="p">.</span><span class="nx">each</span> <span class="nx">bindings</span><span class="p">,</span> <span class="nf">(val,key) -&gt;</span>
      <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isString</span><span class="p">(</span><span class="nx">val</span><span class="p">)</span>
        <span class="nx">result</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">val</span>
      <span class="k">else</span>
        <span class="nx">result</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="nv">selector: </span><span class="nx">val</span><span class="p">[</span><span class="mi">0</span><span class="p">]}</span>
        <span class="k">if</span> <span class="nx">member</span><span class="o">=</span><span class="nx">val</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
          <span class="nx">result</span><span class="p">[</span><span class="nx">key</span><span class="p">].</span><span class="nv">converter = </span><span class="nf">(dir,val,attr,model) -&gt;</span>
            <span class="k">if</span> <span class="nx">dir</span><span class="o">==</span><span class="s">&#39;ModelToView&#39;</span>
              <span class="nx">model</span><span class="p">[</span><span class="nx">member</span><span class="p">]()</span>
            <span class="k">else</span>
              <span class="nx">model</span><span class="p">[</span><span class="nx">member</span><span class="p">](</span><span class="nx">val</span><span class="p">)</span>
    <span class="nx">result</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>Associated bindings.
TODO: Explain the format of this.bindings</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">initBindings: </span><span class="o">-&gt;</span>
    <span class="k">if</span> <span class="nx">@bindings</span>
      <span class="nv">bindings = </span><span class="nx">@convertBindings</span><span class="p">(</span><span class="nx">@bindings</span><span class="p">)</span>
      <span class="nx">@binder</span><span class="p">.</span><span class="nx">bind</span> <span class="nx">@model</span><span class="p">,</span> <span class="nx">@$el</span><span class="p">,</span> <span class="nx">bindings</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>Override for post render customization</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">onRender: </span><span class="o">-&gt;</span>
    <span class="nx">@initBindings</span><span class="p">()</span> <span class="k">if</span> <span class="nx">@bindings</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>Override for custom close code</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">onClose: </span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>Default <code>close</code> implementation, for removing a view from the
DOM and unbinding it. Region managers will call this method
for you. You can specify an <code>onClose</code> method in your view to
add custom code that is called after the view is closed.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">close: </span><span class="o">-&gt;</span>
    <span class="nx">@unbindAll</span><span class="p">()</span> <span class="c1"># bindto events</span>
    <span class="nx">@unbind</span><span class="p">()</span>    <span class="c1"># custom view events</span>
    <span class="k">if</span> <span class="nx">@attached</span> <span class="k">then</span> <span class="nx">@$el</span><span class="p">.</span><span class="nx">empty</span><span class="p">()</span> <span class="k">else</span> <span class="nx">@remove</span><span class="p">()</span>    <span class="c1"># remove el from DOM (and DOM events)</span>
    <span class="nx">@onClose</span><span class="p">()</span>   <span class="c1"># custom cleanup code</span>


<span class="nv">module.exports = </span><span class="nx">ItemView</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 